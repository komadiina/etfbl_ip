-- Users
CREATE TABLE Users (
    UserID INT PRIMARY KEY AUTO_INCREMENT,
    Username VARCHAR(50) UNIQUE NOT NULL,
    Password VARCHAR(255) NOT NULL,
    FirstName VARCHAR(50) NOT NULL,
    LastName VARCHAR(50) NOT NULL,
    Email VARCHAR(100) UNIQUE NOT NULL,
    PhoneNumber VARCHAR(20),
    UserType ENUM('Client', 'Employee') NOT NULL,
    AvatarImage BLOB,
    IsActive BOOLEAN NOT NULL DEFAULT TRUE
);

-- Employees
CREATE TABLE Employees (
    EmployeeID INT PRIMARY KEY,
    Role ENUM('Administrator', 'Operator', 'Manager') NOT NULL,
    FOREIGN KEY (EmployeeID) REFERENCES Users(UserID)
);

-- Clients
CREATE TABLE Clients (
    ClientID INT PRIMARY KEY,
    IDCardNumber VARCHAR(20) UNIQUE NOT NULL,
    PassportID VARCHAR(20),
    Balance DECIMAL(10, 2) NOT NULL DEFAULT 0.00,
    FOREIGN KEY (ClientID) REFERENCES Users(UserID)
);

-- Manufacturers
CREATE TABLE Manufacturers (
    ManufacturerID INT PRIMARY KEY AUTO_INCREMENT,
    Name VARCHAR(100) NOT NULL,
    Country VARCHAR(50) NOT NULL,
    Address TEXT,
    Phone VARCHAR(20),
    Fax VARCHAR(20),
    Email VARCHAR(100)
);

-- TransportationDevices
CREATE TABLE TransportationDevices (
    DeviceID INT PRIMARY KEY AUTO_INCREMENT,
    UniqueIdentifier VARCHAR(50) UNIQUE NOT NULL,
    DeviceType ENUM('Vehicle', 'ElectricBicycle', 'ElectricScooter') NOT NULL,
    AcquisitionDate DATE NOT NULL,
    PurchasePrice DECIMAL(10, 2) NOT NULL,
    ManufacturerID INT,
    Model VARCHAR(100) NOT NULL,
    Description TEXT,
    Status ENUM('Available', 'Rented', 'Broken') NOT NULL,
    Image BLOB,
    FOREIGN KEY (ManufacturerID) REFERENCES Manufacturers(ManufacturerID)
);

-- Vehicles
CREATE TABLE Vehicles (
    VehicleID INT PRIMARY KEY,
    FOREIGN KEY (VehicleID) REFERENCES TransportationDevices(DeviceID)
);

-- ElectricBicycles
CREATE TABLE ElectricBicycles (
    BicycleID INT PRIMARY KEY,
    Autonomy INT NOT NULL,
    FOREIGN KEY (BicycleID) REFERENCES TransportationDevices(DeviceID)
);

-- ElectricScooters
CREATE TABLE ElectricScooters (
    ScooterID INT PRIMARY KEY,
    MaxSpeed INT NOT NULL,
    FOREIGN KEY (ScooterID) REFERENCES TransportationDevices(DeviceID)
);

-- Breakdowns
CREATE TABLE Breakdowns (
    BreakdownID INT PRIMARY KEY AUTO_INCREMENT,
    DeviceID INT,
    Description TEXT NOT NULL,
    DateTimeRecorded DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (DeviceID) REFERENCES TransportationDevices(DeviceID)
);

-- RentalPrices
CREATE TABLE RentalPrices (
    PriceID INT PRIMARY KEY AUTO_INCREMENT,
    DeviceType ENUM('Vehicle', 'ElectricBicycle', 'ElectricScooter') NOT NULL,
    PricePerMinute DECIMAL(5, 2) NOT NULL,
    IsActive BOOLEAN NOT NULL DEFAULT TRUE,
    UNIQUE (DeviceType, IsActive)
);

-- Rentals
CREATE TABLE Rentals (
    RentalID INT PRIMARY KEY AUTO_INCREMENT,
    ClientID INT,
    DeviceID INT,
    PriceID INT,
    StartDateTime DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    EndDateTime DATETIME,
    PickupX INT NOT NULL,
    PickupY INT NOT NULL,
    DropoffX INT,
    DropoffY INT,
    Duration INT, -- in minutes
    FOREIGN KEY (ClientID) REFERENCES Clients(ClientID),
    FOREIGN KEY (DeviceID) REFERENCES TransportationDevices(DeviceID),
    FOREIGN KEY (PriceID) REFERENCES RentalPrices(PriceID)
);

-- Invoices
CREATE TABLE Invoices (
    InvoiceID INT PRIMARY KEY AUTO_INCREMENT,
    RentalID INT,
    Amount DECIMAL(10, 2) NOT NULL,
    PDFFile BLOB,
    FOREIGN KEY (RentalID) REFERENCES Rentals(RentalID)
);

-- Posts
CREATE TABLE Posts (
    PostID INT PRIMARY KEY AUTO_INCREMENT,
    EmployeeID INT,
    Title VARCHAR(255) NOT NULL,
    Content TEXT NOT NULL,
    CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (EmployeeID) REFERENCES Employees(EmployeeID)
);

-- Promotions
CREATE TABLE Promotions (
    PromotionID INT PRIMARY KEY AUTO_INCREMENT,
    Title VARCHAR(255) NOT NULL,
    Description TEXT NOT NULL,
    StartDate DATE NOT NULL,
    EndDate DATE NOT NULL
);
